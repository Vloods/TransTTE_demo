# Cервис интеллектуального поиска маршрутов Pathfinder

Представленный пайплайн позволяет валидировать и уточнять алгоритмы построения кратчайшего маршрута посредством использования гибридной графовой модели машинного обучения. Основным назначением программы является оценка маршрутов для самокатов по метрикам затрачиваемого на поездку времени, живописности окружающего ландшафта и безопасности с целью улучшения пользовательского опыта.

# Структура репозитория
- `algorithms` - ноутбуки и скирпты для вызова тех или иных алгоритмов
- `preprocessing` - ноутбуки для препроцессинга данных
- `backend` - бекенд сервер на FastAPI, реализует метод генерации маршрутов и их ETA по 2м точкам
- `data` и `backend/app/data` - используемые данные: граф Москвы, матрица высот и тд. 

# Туториал
- Запустите `backend/app/dijkstra_inference.py` с координатами и требуемыми весами из `backend/app/data/weights`
- Вы получите два массива, второй - координаты путей
- Если необходимо, запустите `inference_ETA.py` по примеру для получения ETA
## Pipeline
![image](https://i.imgur.com/PdSrogz.png)

## Архитектура предиктивной модели ETA

Для решения задачи оценки времени прибытия используется гибридная архитектура, состоящая из графовой нейронной сети, осуществляющей построение векторных представлений путей самокатов, и регрессионной модели.
 
## Прочие метрики

Расчет метрики, оценивающей визуальное окружение во время поездки, осуществляется посредством проекции геометок смежных с улицами достопримечательностей, парковых пространств и прочих культурных площадок на транспортный граф. Впоследствии полученное таким образом признаковое описание ребер маршрута агрегируется в зависимости от персональных предпочтений пользователя в оценку потенциального пути следования.  

Метрика безопасности пути также складывается из безопасности ребер, которая получается из данных о ближайших ДТП, косвенной исторической информации о поездках самокатов на определенных участках дорог и специфики ассоциированного с элементами транспортного графа ландшафта. 

## Данные
1. Предоставленные Whoosh данные о поездках на самокатах, каршеринге и такси за Май

2. XML, GeoJSON и другие типы геоданных Москвы: [OSM](https://download.bbbike.org/osm/bbbike/Moscow/)

3. GeoJSON ДТП: [Карта ДТП](https://dtp-stat.ru/opendata/) 

Данные потяжелее лежат [ТУТ](https://drive.google.com/drive/folders/1BJzO_0bPF-TlAnkiN37OeygfrDL-NKSr?usp=sharing)

## Препроцессинг данных
1. Для получения графа Москвы, был взят [OSM XML](https://download.bbbike.org/osm/bbbike/Moscow/) и произведено:
   - удаление не нужных ноды(например, нод зданий)
   - формирование связанных с нодами рёбер путей и их фичей(например, тип поверхности, освещённость, длинна дороги и тд)
    
